{% extends 'layout.html.twig' %}

{% block content %}
<a href="/connect"><button class="small green col_2">Connect social network</button></a>
<h1>MyBoxes</h1>
<!-- -->
<input type="hidden" id="filter_likes" value="0"/>
<!-- -->
<div class="box_area">
<div id="boxes0" class="boxes_column"></div>
<div id="boxes1" class="boxes_column"></div>
<div id="boxes2" class="boxes_column"></div>
<div class="box_area_clear"></div>
</div>

<script type="text/javascript">
function loadBoxes(){
 $.getJSON("/boxes",{'likes':$('#filter_likes').val()},
  function(data) {
    $.each(data, function(i,item){

      console.log(item);

      var date = new Date(item.date * 1000);

      var itemData = '<div class="box_area_item">';


	  if( item.title != '' ) itemData = itemData + '<h1>'+item.title+'</h1>';
      if( item.text != '' ) itemData = itemData + '<p>'+item.text+'</p>';
	  
	  var attachments = '';
	  
	  if( item.attachments.length > 0 ){
	  
		attachments = attachments + '<div class="attachments">';
		
		for( index in item.attachments){
		
			var att = item.attachments[index];
			
			if( att.type == 'video' ){
			    attachments = attachments + '<div class="item">';
				attachments = attachments + '<div class="full">'+att.src+'</div>';
				attachments = attachments + '<img src="'+att.image+'"/>';
				attachments = attachments + '<h1>'+att.title+'<h1>';
				attachments = attachments + '<p>'+att.description+'<p>';
			    attachments = attachments + '</div>';
			}
			
			if( att.type == 'photo' ){
				attachments = attachments + '<div class="item">';
                attachments = attachments + '<div class="full">'+att.src+'</div>';
				attachments = attachments + '<img src="'+att.image+'"/>';
				attachments = attachments + '<h1>'+att.title+'<h1>';
				attachments = attachments + '<p>'+att.description+'<p>';
				attachments = attachments + '</div>';
			}
			
			if( att.type == 'link' ){
				attachments = attachments + '<div class="item">';
				attachments = attachments + '<a href="'+att.src+'">'+att.src+'</a>';
				attachments = attachments + '<h1>'+att.title+'<h1>';
				attachments = attachments + '<p>'+att.description+'<p>';
				attachments = attachments + '</div>';
			}		
		}
		
		attachments = attachments + '<div class="box_area_clear"></div></div>';
	  
	  }
	  
      if( attachments != '' ) itemData = itemData + attachments;
	  
      itemData = itemData + '<div class="rate">'+item.likes+'</div>';
	  
      itemData = itemData + '<div class="date">'+date.toString('yyyy/MM/dd'); +'</div>';
	  
	  itemData = itemData + '<div class="from"> '+item.from+'</div>';
	  
      itemData = itemData + '<div class="box_area_clear"></div></div>';

	  var columnIndex = i%3;
	  
      $('#boxes'+columnIndex).append(itemData);
	  
    });
  });
}
loadBoxes();
</script>


{% endblock %}
